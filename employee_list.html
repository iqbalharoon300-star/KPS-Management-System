<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Employee List | KPS Management System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="style.css" />

<style>
/* Employee Styles */
.employee-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(240px,1fr));
  gap: 20px;
  margin-top: 20px;
}
.employee-card {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  transition: .2s;
}
.employee-card:hover { transform: translateY(-3px); }

.employee-card img {
  width: 80px;height:80px;border-radius:50%;
  object-fit:cover;border:2px solid #006b3c;
  margin-bottom:10px;
}
.employee-name { font-weight:700;font-size:1rem;color:#222; }
.employee-role { font-size:.85rem;color:#006b3c;margin:4px 0; }
.employee-section { font-size:.8rem;color:#666;margin-bottom:8px; }

.employee-actions {
  display:flex;gap:10px;justify-content:center;
}
.btn-small {
  padding:6px 10px;border:none;border-radius:5px;font-size:.8rem;
  cursor:pointer;
}
.btn-edit { background:#009e58;color:#fff; }
.btn-delete{ background:#d32f2f;color:#fff; }
.btn-edit:hover{ background:#00b96b; }
.btn-delete:hover{ background:#ff4a4a; }

.filter-bar select{
  padding:6px 10px;border:1px solid #ccc;border-radius:6px;
}
.filter-bar {display:flex;gap:10px;flex-wrap:wrap;margin-bottom:15px;}
</style>
</head>

<body>

<!-- HEADER -->
<div id="header-container"></div>

<!-- PAGE WRAPPER -->
<div class="app-shell">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="nav-title">Main Menu</div>
    <a href="dashboard.html" class="nav-link">ğŸ  Dashboard</a>
    <a href="add_employee.html" class="nav-link">ğŸ‘¤ Add Employee</a>
    <a href="employee_list.html" class="nav-link active">ğŸ“‹ Employee List</a>
    <a href="attendance.html" class="nav-link">ğŸ•’ Attendance</a>
    <a href="overtime.html" class="nav-link">â± Overtime</a>
    <a href="deductions.html" class="nav-link">ğŸ’¸ Deductions</a>
    <a href="requests.html" class="nav-link">ğŸ“© Requests</a>
    <a href="reports.html" class="nav-link">ğŸ“Š Reports</a>
    <a href="meetings.html" class="nav-link">ğŸ“… Meetings</a>
    <a href="notifications.html" class="nav-link">ğŸ”” Notifications</a>
    <a href="settings.html" class="nav-link">âš™ Settings</a>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <h2>Employee List</h2>
    <p class="section-title">View, Edit, or Delete Employees</p>

    <div class="filter-bar">
      <select id="filterSection">
        <option value="">All Sections</option>
        <option>Kcal Life</option>
        <option>Kcal Lunch</option>
        <option>Spring</option>
        <option>Kcal Meal Plan</option>
        <option>FuelUP</option>
      </select>
      <select id="filterRole">
        <option value="">All Roles</option>
        <option>Manager</option>
        <option>Supervisor</option>
        <option>Assistant Supervisor</option>
        <option>Senior Packer</option>
        <option>Junior Packer</option>
        <option>Packer</option>
      </select>
    </div>

    <div id="employeeGrid" class="employee-grid">
      <p>Loading employees...</p>
    </div>

  </main>
</div>

<!-- SCRIPTS -->
<script type="module">
import { protectPage, attachUserInfo, logout, db } from "./app.js";
import { collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

// âœ… Protect only Admin / Manager / Supervisor
protectPage(["admin","manager","supervisor"]);

// âœ… Load Header + user info
fetch("header.html").then(r=>r.text()).then(h=>{
  document.getElementById("header-container").innerHTML = h;
  attachUserInfo();
  document.addEventListener("click",e=>{
    if(e.target.matches("[data-logout]")) logout();
  });
});

// âœ… Load Employees
async function loadEmployees() {
  const grid = document.getElementById("employeeGrid");
  grid.innerHTML = "<p>Loading...</p>";

  const snap = await getDocs(collection(db,"employees"));
  grid.innerHTML = "";

  snap.forEach(docSnap=>{
    const emp=docSnap.data();
    const card=document.createElement("div");
    card.className="employee-card";
    card.innerHTML=`
      <img src="${emp.photoURL || 'assets/user.png'}">
      <div class="employee-name">${emp.fullName || "Unnamed"}</div>
      <div class="employee-role">${emp.role || ""}</div>
      <div class="employee-section">${emp.section || ""} | ${emp.shift || ""}</div>
      <div class="employee-actions">
        <button class="btn-small btn-edit" data-id="${docSnap.id}">Edit</button>
        <button class="btn-small btn-delete" data-id="${docSnap.id}">Delete</button>
      </div>
    `;
    grid.appendChild(card);
  });

  document.querySelectorAll(".btn-edit").forEach(btn=>{
    btn.onclick = ()=>{
      location.href=`edit_employee.html?id=${btn.dataset.id}`;
    };
  });

  document.querySelectorAll(".btn-delete").forEach(btn=>{
    btn.onclick = async ()=>{
      if(confirm("Delete employee?")){
        await deleteDoc(doc(db,"employees",btn.dataset.id));
        alert("Employee removed âœ…");
        loadEmployees();
      }
    };
  });
}

loadEmployees();
</script>

</body>
</html>
